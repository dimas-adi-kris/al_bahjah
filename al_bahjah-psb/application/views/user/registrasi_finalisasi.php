<div class="card o-hidden border-0 shadow-lg my-5">
    <div class="card-body p-0">
        <!-- Nested Row within Card Body -->
        <div class="row">

            <div class="col-lg-12">
            <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-gray-900 text-center"> Finalisasi </h3>
                    </div>

                    <!-- /.card-header -->
                    <div class="card-body detail-card">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-8 col-sm-12 p-3">
                                    <div class="row" id="detail-calon-santri">
                                        <div class="col-12">
                                            <h3 class="text-gray-900" > Data Calon Santri</h3>
                                            <table class="table table-striped mb-5">
                                                <tbody>
                                                    <tr>
                                                        <td>Nama</td>
                                                        <td>:</td>
                                                        <td id="nama">Qory Amanah Putra</td>
                                                    </tr>
                                                    <tr>
                                                        <td>NIK</td>
                                                        <td>:</td>
                                                        <td id="nik">1304080708010003</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Asal Sekolah</td>
                                                        <td>:</td>
                                                        <td id="asal_sekolah">SMAN 1 Batusangkar</td>
                                                    </tr>
                                                    <tr>
                                                        <td>TTL</td>
                                                        <td>:</td>
                                                        <td id="ttl">Batusangkar, 07-08-2001</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Gender</td>
                                                        <td>:</td>
                                                        <td id="gender">LAKI-LAKI</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Alamat</td>
                                                        <td>:</td>
                                                        <td id="alamat">Jorong Utara, Nagari Kumango, Kecamatan Sungai Tarab, Kabupaten Tanah Datar, Sumatera Barat</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Kota</td>
                                                        <td>:</td>
                                                        <td id="kota">Batusangkar</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Negara</td>
                                                        <td>:</td>
                                                        <td id="negara">Indonesia</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Golongan Darah</td>
                                                        <td>:</td>
                                                        <td id="golongan_darah">A</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Riwayat Penyakit</td>
                                                        <td>:</td>
                                                        <td id="riwayat_penyakit">Hepatitis, Tifus, Gejala TB</td>
                                                    </tr>
                                                    <tr>
                                                        <td>ID Program</td>
                                                        <td>:</td>
                                                        <td id="program">Tahfidz</td>
                                                    </tr>
                                                    <tr>
                                                        <td>ID Periode</td>
                                                        <td>:</td>
                                                        <td class="periode">1442 Hijriyah / 2020 Masehi</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row" id="detail-wali-calon-santri">
                                        <div class="col-12 p-3">
                                            <h3 class="text-gray-900" >Data Wali Calon Santri</h3>
                                            <table class="table table-striped">
                                                <tbody>
                                                    <tr>
                                                        <td scop="col">Nama</td>
                                                        <td scop="col">:</td>
                                                        <td scop="col" id="nama_wali_santri">Nazrahelma</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">NIK</td>
                                                        <td>:</td>
                                                        <td id="no_ktp_wali_santri">021027364378</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Email</td>
                                                        <td>:</td>
                                                        <td id="email_wali_santri">iniEmail@domain.com</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Gender</td>
                                                        <td>:</td>
                                                        <td id="gender_wali_santri">PEREMPUAN</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Hubungan</td>
                                                        <td>:</td>
                                                        <td id="hubungan_wali_santri">ORANG TUA KANDUNG</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Pekerjaan</td>
                                                        <td>:</td>
                                                        <td id="pekerjaan_wali_santri">Guru</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Alamat</td>
                                                        <td>:</td>
                                                        <td id="alamat_wali_santri">Jorong Utara, Nagari Kumango, Kecamatan Sungai Tarab, Kabupaten Tanah Datar, Sumatera Barat</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Kota</td>
                                                        <td>:</td>
                                                        <td id="kota_wali_santri">Batusangkar</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">Negara</td>
                                                        <td>:</td>
                                                        <td id="negara_wali_santri">Indonesia</td>
                                                    </tr>
                                                    <tr>
                                                        <td scop="row">HP/Telepon</td>
                                                        <td>:</td>
                                                        <td id="telepon_wali_santri">085363021295</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-12 p-3">
                                    <div class="row">
                                        <h3 class="text-gray-900 ml-3">Berkas Upload</h3>
                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Kartu Keluarga</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Raport</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Ijazah Terakhir</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Kartu Keluarga</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Raport</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Ijazah Terakhir</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-2">
                                            <div class="card" style="width: 18rem;">
                                                <div class="card-body">
                                                    <h2 class="card-title">Ijazah Terakhir</h2><br>
                                                    <h6 class="text-muted">10:58, 09 November 2020</h6>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>

                <div class="p-5">

                    <div class="text-center">
                        <h1 class="h4 text-gray-900 mb-4"> Cetak Kartu Ujian </h1>
                    </div>

                        <div class="row justify-content-center mt-5">
                            <div>
                                <i class="fas fa-id-card px-3 px-sm-4 mt-3 mb-4" style="font-size:15rem;"></i>
                            </div>

                            <div>
                                <div class="form-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="gridCheck">
                                        <label class="form-check-label" for="gridCheck">
                                            Saya menyetujui bahwa data yang saya isi adalah sebenar-benarnya, Jika ada kepalsuan data maka saya akan bertanggung jawab dan menerima resiko dalam bentuk apapun.
                                        </label>
                                    </div>
                                    <hr>
                                </div>

                            <button type="submit" class="btn btn-success float-right" id="kartu-ujian"> Simpan Data dan Cetak Kartu Ujian </button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- <textarea name="test" id="test" cols="30" rows="10"></textarea> -->
<script>
$(document).ready(function () {

    var id_calon_santri = $("#btn-step-calon-santri").attr('id_calon_santri');

    renderDataSantri();
    renderDataWali();

    function renderDataSantri() {
        $.ajax({
            method: "POST",
            url: "<?=base_url()?>index.php/CalonSantri/getCalonSantriById",
            data: {
                id_calon_santri
            }
        })

        .done(function(msg){
            // $("#status").attr('checked',(res['status_verifikasi_registrasi']=="TERVERIFIKASI" ? true : false));
            var res = JSON.parse(msg);

            //SET DATA TABEL SANTRI
            $("#nama").text(res['nama']);
            $("#nik").text(res['nik']);
            $("#asal_sekolah").text(res['asal_sekolah']);
            $("#ttl").text(`${res['tempat_lahir']}, ${res['tanggal_lahir'].split("-").reverse().join("-")}`);
            $("#gender").text(res['gender']);
            $("#alamat").text(res['alamat']);
            $("#kota").text(res['kota']);
            $("#negara").text(res['negara']);
            $("#golongan_darah").text(res['golongan_darah']);
            $("#riwayat_penyakit").text(res['riwayat_penyakit']);


            $.ajax({
                method: "POST",
                url: "<?=base_url()?>index.php/Program/getProgramById",
                data: {
                    id_program: res['id_program']
                }
            }).done(function(msg) {
                var program = JSON.parse(msg);
                $("#program").text(program['nama']);
            });

            $.ajax({
                method: "POST",
                url: "<?=base_url()?>index.php/Periode/getPeriodeById",
                data: {
                    id_periode: res['id_periode']
                }
                }).done(function(msg) {
                var periode = JSON.parse(msg)
                console.log(periode['tahun_ajaran_hijriyah']);
                $(".periode").html(periode['tahun_ajaran_hijriyah'] + " Hijriyah / " + periode['tahun_ajaran_masehi'] + " Masehi");
            });

        });


    }


    function renderDataWali(){
        $.ajax({
            method: "POST",
            url: "<?=base_url()?>index.php/WaliCalonSantri/getDataById",
            data: { id_calon_santri
                    }
        })
        .done(function(msg) {
            var res = JSON.parse(msg);
            console.log(res['nama']);
            if (res["nama"] == undefined) {
            $("#edit_wali_button").attr("disabled", true);
            return;
            }

            // SET DATA WALI
            $("#nama_wali_santri").text(res['nama']);
            $("#no_ktp_wali_santri").text(res['no_ktp']);
            $("#email_wali_santri").text(res['email']);
            $("#gender_wali_santri").text(res['gender']);
            $("#hubungan_wali_santri").text(res['hubungan']);
            $("#pekerjaan_wali_santri").text(res['pekerjaan']);
            $("#alamat_wali_santri").text(res['alamat']);
            $("#kota_wali_santri").text(res['kota']);
            $("#negara_wali_santri").text(res['negara']);
            $("#telepon_wali_santri").text(res['telepon'])

            // Gender
            if (res['gender'] == "LAKI-LAKI") {
                $("#wali_laki_laki").attr("selected", true);
            } else {
                $("#wali_perempuan").attr("selected", true);
            }

            // Hubungan
            if (res['hubungan'] == "ORANG TUA KANDUNG") {
            $("#wali_orang_tua_kandung").attr("selected", true);
            } else if (res['hubungan'] == "SAUDARA ORANG TUA") {
            $("#wali_saudara_orang_tua").attr("selected", true);
            } else if (res['hubungan'] == "KAKEK/NENEK") {
            $("#wali_kakek_nenek").attr("selected", true);
            } else {
            $("#wali_lainnya").attr("selected", true);
            }
            })

    }


    // kartu ujian
    $('#kartu-ujian').click(function() {
        var img = document.createElement('IMG');
        var imgData;
        img.src = '<?=base_url();?>assets/img/kartu_ujian/kartuUjian01.png';
        img.onload = function(){
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            canvas.height = this.naturalHeight;
            canvas.width = this.naturalWidth;
            ctx.drawImage(this,0,0);
            imgData = canvas.toDataURL('image/jpg');
            var doc = new jsPDF("l", "mm", "b5");

            doc.addImage(imgData, 'png', 0, 0, 250,176,"", "FAST");
            $.ajax({
                method: "POST",
                url: "<?=base_url()?>/index.php/CalonSantri/getCalonSantri",
                data: {}
            })
            .done(function(msg) {
                var res = JSON.parse(msg);
                // console.log(res);
                const name = res[0]['nama'];
                var kelas = res[0]['alamat'];
                var no_ujian = res[0]['nik'];
                var ruang = res[0]['kota'];
                // console.log(typeof(name));
                // console.log(ruang);
                // console.log(kelas);
                // console.log(no_ujian);

                doc.setFontSize(22);
                doc.setTextColor(0, 0, 0);

                doc.text(85, 93, name);
                // doc.text(50, 122, kelas);
                doc.text(85, 119, ruang);
                doc.text(85, 106, no_ujian);
                doc.save('test.pdf');
                // var file = doc.output('datauri');
                // // console.log(typeof(file));
                // // console.log(file);
                // // console.log('data');
                // var fd = new FormData();
                // fd.append("myPdf", file);

                // // var tes = doc.save('test.pdf');
                // $.ajax({
                // type: "POST",
                // url: "<?=base_url();?>/index.php/Auth/tes",
                // dataType: 'text',
                // processData: false,
                // contentType: false,
                // data: fd
                // }).done(function(msg) {
                // // console.log('berhasil');
                // // console.log(msg);
                // })
            });
        }
    });



});





</script>